<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Building Webhook Handlers with flashQ: Complete Tutorial - flashQ Blog</title>
  <meta name="description" content="Learn to build secure, reliable webhook handlers with flashQ. Cover signature verification, retry logic, idempotency, and processing webhooks from Stripe, GitHub, and more.">
  <meta name="keywords" content="webhook handlers, flashq webhooks, stripe webhooks, github webhooks, webhook processing, webhook queue, async webhooks, webhook security">
  <meta name="robots" content="index, follow">

  <meta property="og:title" content="Building Webhook Handlers with flashQ: Complete Tutorial">
  <meta property="og:description" content="Build secure, reliable webhook handlers with flashQ. Signature verification, retries, and idempotency.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://flashq.dev/blog/building-webhook-handlers.html">
  <meta property="og:image" content="https://flashq.dev/og-image.png">
  <meta property="article:published_time" content="2026-01-19">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Building Webhook Handlers with flashQ">
  <meta name="twitter:description" content="Secure, reliable webhook handlers with flashQ.">
  <meta name="twitter:image" content="https://flashq.dev/og-image.png">

  <link rel="canonical" href="https://flashq.dev/blog/building-webhook-handlers.html">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš¡</text></svg>">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "Building Webhook Handlers with flashQ: Complete Tutorial",
    "description": "Comprehensive guide to building secure webhook handlers with flashQ job queues.",
    "datePublished": "2026-01-19",
    "author": { "@type": "Organization", "name": "flashQ" },
    "publisher": { "@type": "Organization", "name": "flashQ", "url": "https://flashq.dev" }
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://flashq.dev" },
      { "@type": "ListItem", "position": 2, "name": "Blog", "item": "https://flashq.dev/blog/" },
      { "@type": "ListItem", "position": 3, "name": "Building Webhook Handlers", "item": "https://flashq.dev/blog/building-webhook-handlers.html" }
    ]
  }
  </script>
  <!-- Highlight.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
</head>
<body>
  <nav>
    <div class="container wide">
      <a href="../" class="logo"><span>âš¡</span> flashQ</a>
      <div class="nav-links">
        <a href="../#features">Features</a>
        <a href="../blog/" class="active">Blog</a>
        <a href="../docs/">Docs</a>
        <a href="https://github.com/egeominotti/flashq" target="_blank">GitHub</a>
        <a href="../docs/#quickstart" class="btn btn-primary">Get Started</a>
      </div>
      <button class="mobile-menu-btn" aria-label="Menu"><span></span><span></span><span></span></button>
    </div>
  </nav>

  <div class="mobile-menu">
    <a href="../#features">Features</a>
    <a href="../blog/">Blog</a>
    <a href="../docs/">Docs</a>
    <a href="https://github.com/egeominotti/flashq" target="_blank">GitHub</a>
    <a href="../docs/#quickstart" class="btn btn-primary">Get Started</a>
  </div>

  <header class="article-header header-tutorial">
    <div class="container">
      <span class="article-tag">Integration</span>
      <h1>Building Webhook Handlers with flashQ</h1>
      <div class="article-meta">
        <span>ğŸ“… January 19, 2026</span>
        <span>â±ï¸ 10 min read</span>
      </div>
    </div>
  </header>

  <article class="article-content">
    <div class="container">
      <p>Webhooks need to be fast, secure, and reliable. Learn how to build production-grade webhook handlers using flashQ with proper signature verification, idempotency, and async processing.</p>

      <h2>The Webhook Challenge</h2>

      <p>Webhook providers expect fast responses (typically under 3 seconds). If processing takes longer, you risk timeouts and retries. The solution: immediately queue webhook payloads and process them asynchronously.</p>

      <pre><code class="language-typescript">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     POST /webhook      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Stripe    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  Your API    â”‚
â”‚   (sender)  â”‚                        â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  1. Verify   â”‚
                                       â”‚  2. Queue    â”‚
     â† 200 OK (immediate)              â”‚  3. Return   â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â†“
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚   flashQ     â”‚
                                       â”‚   Worker     â”‚
                                       â”‚              â”‚
                                       â”‚  Process     â”‚
                                       â”‚  webhook     â”‚
                                       â”‚  async       â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

      <h2>Basic Webhook Handler</h2>

      <pre><code class="language-typescript">import express from 'express';
import { FlashQ, Worker } from 'flashq';

const app = express();
const client = new FlashQ({ host: 'localhost', port: 6789 });

await client.connect();

// Webhook endpoint - fast response, async processing
app.post('/webhook', express.raw({ type: 'application/json' }), async (req, res) => {
  try {
    const payload = JSON.parse(req.body.toString());

    // Queue for async processing
    await client.push('webhooks', {
      source: 'generic',
      payload,
      receivedAt: Date.now()
    });

    res.status(200).send('OK');
  } catch (error) {
    res.status(400).send('Invalid payload');
  }
});

// Worker processes webhooks asynchronously
const worker = new Worker('webhooks', async (job) => {
  const { source, payload } = job.data;
  console.log(`Processing webhook from ${source}`);
  await processWebhook(payload);
});

app.listen(3000);</code></pre>

      <h2>Stripe Webhook Handler</h2>

      <p>Stripe webhooks require signature verification using their <code>stripe-signature</code> header:</p>

      <pre><code class="language-typescript">import Stripe from 'stripe';
import { FlashQ, Worker } from 'flashq';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY);
const client = new FlashQ({ host: 'localhost', port: 6789 });

await client.connect();

app.post('/webhook/stripe', express.raw({ type: 'application/json' }), async (req, res) => {
  const signature = req.headers['stripe-signature'];

  try {
    // 1. Verify signature
    const event = stripe.webhooks.constructEvent(
      req.body,
      signature,
      process.env.STRIPE_WEBHOOK_SECRET
    );

    // 2. Queue with idempotency key (Stripe event ID)
    await client.push('stripe-webhooks', {
      eventId: event.id,
      type: event.type,
      data: event.data.object
    }, {
      unique_key: event.id  // Prevents duplicate processing
    });

    // 3. Acknowledge immediately
    res.status(200).json({ received: true });

  } catch (error) {
    console.error('Webhook error:', error.message);
    res.status(400).send(`Webhook Error: ${error.message}`);
  }
});

// Stripe webhook worker
const stripeWorker = new Worker('stripe-webhooks', async (job) => {
  const { eventId, type, data } = job.data;

  switch (type) {
    case 'payment_intent.succeeded':
      await handlePaymentSuccess(data);
      break;
    case 'customer.subscription.created':
      await handleNewSubscription(data);
      break;
    case 'invoice.payment_failed':
      await handleFailedPayment(data);
      break;
    default:
      console.log(`Unhandled event type: ${type}`);
  }
}, { concurrency: 5 });</code></pre>

      <h2>GitHub Webhook Handler</h2>

      <p>GitHub uses HMAC-SHA256 signatures in the <code>x-hub-signature-256</code> header:</p>

      <pre><code class="language-typescript">import { createHmac } from 'crypto';
import { FlashQ, Worker } from 'flashq';

const client = new FlashQ({ host: 'localhost', port: 6789 });

function verifyGitHubSignature(payload, signature, secret) {
  const expected = 'sha256=' + createHmac('sha256', secret)
    .update(payload)
    .digest('hex');

  return signature === expected;
}

app.post('/webhook/github', express.raw({ type: 'application/json' }), async (req, res) => {
  const signature = req.headers['x-hub-signature-256'];
  const event = req.headers['x-github-event'];
  const deliveryId = req.headers['x-github-delivery'];

  // 1. Verify signature
  if (!verifyGitHubSignature(req.body, signature, process.env.GITHUB_WEBHOOK_SECRET)) {
    return res.status(401).send('Invalid signature');
  }

  const payload = JSON.parse(req.body.toString());

  // 2. Queue with delivery ID as unique key
  await client.push('github-webhooks', {
    deliveryId,
    event,
    payload
  }, {
    unique_key: deliveryId  // Idempotency
  });

  res.status(200).send('OK');
});

// GitHub webhook worker
const githubWorker = new Worker('github-webhooks', async (job) => {
  const { event, payload } = job.data;

  switch (event) {
    case 'push':
      await handlePush(payload);
      break;
    case 'pull_request':
      await handlePullRequest(payload);
      break;
    case 'issues':
      await handleIssue(payload);
      break;
  }
});</code></pre>

      <h2>Generic HMAC Verification</h2>

      <p>For services using standard HMAC-SHA256:</p>

      <pre><code class="language-typescript">import { createHmac, timingSafeEqual } from 'crypto';

function verifyHmacSignature(payload, signature, secret) {
  const expected = createHmac('sha256', secret)
    .update(payload)
    .digest('hex');

  // Extract hex part if prefixed (e.g., "sha256=...")
  const received = signature.replace('sha256=', '');

  // Use timing-safe comparison to prevent timing attacks
  try {
    return timingSafeEqual(
      Buffer.from(expected, 'hex'),
      Buffer.from(received, 'hex')
    );
  } catch {
    return false;
  }
}</code></pre>

      <h2>Idempotency with unique_key</h2>

      <p>Webhook providers often retry on failures. Use flashQ's <code>unique_key</code> to prevent duplicate processing:</p>

      <pre><code class="language-typescript">// Stripe: Use event ID
await client.push('stripe', data, {
  unique_key: event.id
});

// GitHub: Use delivery ID
await client.push('github', data, {
  unique_key: deliveryId
});

// Custom: Generate from payload
const idempotencyKey = createHash('sha256')
  .update(JSON.stringify(payload))
  .digest('hex');

await client.push('webhooks', data, {
  unique_key: idempotencyKey
});</code></pre>

      <h2>Error Handling & Retries</h2>

      <pre><code class="language-typescript">const worker = new Worker('webhooks', async (job) => {
  const { eventId, type, data } = job.data;

  try {
    await processWebhook(type, data);
  } catch (error) {
    // Log for debugging
    console.error(`Webhook ${eventId} failed:`, error);

    // Check if we should retry
    if (isRetryableError(error)) {
      throw error; // Triggers automatic retry
    }

    // Non-retryable: log and complete
    await logFailedWebhook(eventId, error);
  }
});

function isRetryableError(error) {
  const retryableCodes = [408, 429, 500, 502, 503, 504];
  return error.message.includes('ECONNREFUSED') ||
         error.message.includes('ETIMEDOUT') ||
         retryableCodes.some(code => error.message.includes(String(code)));
}</code></pre>

      <h2>Webhook Configuration Options</h2>

      <pre><code class="language-typescript">// Configure retry behavior
await client.push('webhooks', payload, {
  unique_key: eventId,        // Idempotency
  max_attempts: 5,            // Retry 5 times
  backoff: 1000,              // Start with 1s delay
  timeout: 30000,             // 30s processing timeout
  priority: 10                // Higher priority
});</code></pre>

      <div class="callout callout-success">
        <strong>Key Takeaways:</strong> Always verify signatures, use unique_key for idempotency, respond immediately (200 OK), and process asynchronously with proper retry logic.
      </div>

      <h2>Related Resources</h2>
      <ul>
        <li><a href="error-handling-retry-patterns.html">Error Handling & Retry Patterns</a></li>
        <li><a href="production-checklist.html">Production Checklist</a></li>
        <li><a href="debugging-queue-problems.html">Debugging Queue Problems</a></li>
      </ul>

      <div class="article-cta">
        <h3>Build Reliable Webhooks</h3>
        <p>Get started with flashQ for secure, reliable webhook processing.</p>
        <a href="../docs/#quickstart" class="btn btn-primary">Get Started â†’</a>
      </div>
    </div>
  </article>

  <footer>
    <div class="container">
      <a href="../" class="logo"><span>âš¡</span> flashQ</a>
      <div class="footer-links">
        <a href="https://github.com/egeominotti/flashq" target="_blank">GitHub</a>
        <a href="https://npmjs.com/package/flashq" target="_blank">npm</a>
        <a href="../docs/">Docs</a>
        <a href="../blog/">Blog</a>
      </div>
      <div class="footer-copy">Â© 2026 flashQ. MIT License.</div>
    </div>
  </footer>

  <script src="../script.js"></script>
  <script>hljs.highlightAll();</script>
</body>
</html>
