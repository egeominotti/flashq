<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scaling flashQ with Clustering: High Availability Guide - flashQ Blog</title>
  <meta name="description" content="Deploy flashQ in high availability mode with clustering. Learn leader election, automatic failover, Kubernetes deployment, and multi-node architecture.">
  <meta name="keywords" content="flashq clustering, job queue scaling, high availability, leader election, kubernetes deployment, flashq ha, distributed queue">
  <meta name="robots" content="index, follow">

  <meta property="og:title" content="Scaling flashQ with Clustering: High Availability Guide">
  <meta property="og:description" content="Deploy flashQ in high availability mode with clustering, leader election, and automatic failover.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://flashq.dev/blog/scaling-clustering.html">
  <meta property="og:image" content="https://flashq.dev/og-image.png">
  <meta property="article:published_time" content="2026-01-19">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Scaling flashQ with Clustering">
  <meta name="twitter:description" content="High availability mode with clustering, leader election, and automatic failover.">
  <meta name="twitter:image" content="https://flashq.dev/og-image.png">

  <link rel="canonical" href="https://flashq.dev/blog/scaling-clustering.html">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš¡</text></svg>">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "Scaling flashQ with Clustering: High Availability Guide",
    "description": "Deploy flashQ in high availability mode with clustering, leader election, and automatic failover.",
    "datePublished": "2026-01-19",
    "author": { "@type": "Organization", "name": "flashQ" },
    "publisher": { "@type": "Organization", "name": "flashQ", "url": "https://flashq.dev" }
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://flashq.dev" },
      { "@type": "ListItem", "position": 2, "name": "Blog", "item": "https://flashq.dev/blog/" },
      { "@type": "ListItem", "position": 3, "name": "Scaling with Clustering", "item": "https://flashq.dev/blog/scaling-clustering.html" }
    ]
  }
  </script>
</head>
<body>
  <nav>
    <div class="container wide">
      <a href="../" class="logo"><span>âš¡</span> flashQ</a>
      <div class="nav-links">
        <a href="../#features">Features</a>
        <a href="../blog/" class="active">Blog</a>
        <a href="../docs/">Docs</a>
        <a href="https://github.com/egeominotti/flashq" target="_blank">GitHub</a>
        <a href="../docs/#quickstart" class="btn btn-primary">Get Started</a>
      </div>
      <button class="mobile-menu-btn" aria-label="Menu"><span></span><span></span><span></span></button>
    </div>
  </nav>

  <div class="mobile-menu">
    <a href="../#features">Features</a>
    <a href="../blog/">Blog</a>
    <a href="../docs/">Docs</a>
    <a href="https://github.com/egeominotti/flashq" target="_blank">GitHub</a>
    <a href="../docs/#quickstart" class="btn btn-primary">Get Started</a>
  </div>

  <header class="article-header">
    <div class="container">
      <span class="article-tag">Infrastructure</span>
      <h1>Scaling flashQ with Clustering: High Availability Guide</h1>
      <div class="article-meta">
        <span>ğŸ“… January 19, 2026</span>
        <span>â±ï¸ 12 min read</span>
      </div>
    </div>
  </header>

  <article class="article-content">
    <div class="container">
      <p>Deploy flashQ in high availability mode with clustering. Learn leader election, automatic failover, and Kubernetes deployment strategies.</p>

      <h2>Clustering Architecture</h2>

      <p>flashQ clustering uses PostgreSQL as the coordination layer for leader election and shared state:</p>

      <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node 1     â”‚     â”‚   Node 2     â”‚     â”‚   Node 3     â”‚
â”‚  (Leader)    â”‚     â”‚ (Follower)   â”‚     â”‚ (Follower)   â”‚
â”‚              â”‚     â”‚              â”‚     â”‚              â”‚
â”‚ âœ“ Push/Pull  â”‚     â”‚ âœ“ Push/Pull  â”‚     â”‚ âœ“ Push/Pull  â”‚
â”‚ âœ“ Background â”‚     â”‚ âœ— Background â”‚     â”‚ âœ— Background â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚                    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   PostgreSQL    â”‚
                   â”‚ (Shared State)  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

      <h3>What the Leader Does</h3>
      <ul>
        <li><strong>Background tasks</strong>: Cron job execution, timeout checks, cleanup</li>
        <li><strong>Single responsibility</strong>: Only one node runs background tasks</li>
        <li><strong>Automatic election</strong>: Uses PostgreSQL advisory locks</li>
      </ul>

      <h3>What All Nodes Do</h3>
      <ul>
        <li><strong>Handle requests</strong>: Push, pull, ack, fail operations</li>
        <li><strong>Serve API</strong>: HTTP and TCP connections</li>
        <li><strong>Heartbeat</strong>: Report health to PostgreSQL</li>
      </ul>

      <h2>Enabling Clustering</h2>

      <h3>Environment Variables</h3>

      <table>
        <thead>
          <tr>
            <th>Variable</th>
            <th>Required</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>CLUSTER_MODE</code></td>
            <td>Yes</td>
            <td>Set to <code>1</code> to enable clustering</td>
          </tr>
          <tr>
            <td><code>NODE_ID</code></td>
            <td>Yes</td>
            <td>Unique identifier for this node</td>
          </tr>
          <tr>
            <td><code>DATABASE_URL</code></td>
            <td>Yes</td>
            <td>PostgreSQL connection string</td>
          </tr>
          <tr>
            <td><code>NODE_HOST</code></td>
            <td>Optional</td>
            <td>Host address for node registration</td>
          </tr>
        </tbody>
      </table>

      <h3>Starting a Cluster</h3>

      <pre><code><span class="comment"># Node 1 - Will become leader (first to acquire lock)</span>
CLUSTER_MODE=1 \
NODE_ID=node-1 \
DATABASE_URL=postgres://user:pass@db:5432/flashq \
HTTP=1 HTTP_PORT=6790 PORT=6789 \
./flashq-server

<span class="comment"># Node 2 - Follower</span>
CLUSTER_MODE=1 \
NODE_ID=node-2 \
DATABASE_URL=postgres://user:pass@db:5432/flashq \
HTTP=1 HTTP_PORT=6792 PORT=6793 \
./flashq-server

<span class="comment"># Node 3 - Follower</span>
CLUSTER_MODE=1 \
NODE_ID=node-3 \
DATABASE_URL=postgres://user:pass@db:5432/flashq \
HTTP=1 HTTP_PORT=6794 PORT=6795 \
./flashq-server</code></pre>

      <h2>Leader Election</h2>

      <p>flashQ uses PostgreSQL advisory locks for leader election:</p>

      <pre><code><span class="comment">-- Leader election query (internal)</span>
<span class="keyword">SELECT</span> pg_try_advisory_lock(12345);

<span class="comment">-- Returns TRUE if lock acquired (becomes leader)</span>
<span class="comment">-- Returns FALSE if another node holds the lock</span></code></pre>

      <h3>Automatic Failover</h3>

      <pre><code>Timeline:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T+0s    Node 1 is leader, holds advisory lock               â”‚
â”‚ T+5s    Node 1 crashes                                      â”‚
â”‚ T+5s    PostgreSQL releases advisory lock automatically     â”‚
â”‚ T+6s    Node 2 acquires lock, becomes new leader            â”‚
â”‚ T+6s    Node 2 starts running background tasks              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="comment"># Failover happens within ~1 second of leader failure</span></code></pre>

      <h3>Checking Cluster Status</h3>

      <pre><code><span class="comment"># Check node health and leader status</span>
curl http://localhost:6790/health
{
  "status": "healthy",
  "node_id": "node-1",
  "is_leader": true,
  "uptime_seconds": 3600
}

<span class="comment"># List all nodes in cluster</span>
curl http://localhost:6790/cluster/nodes
{
  "nodes": [
    { "id": "node-1", "is_leader": true },
    { "id": "node-2", "is_leader": false },
    { "id": "node-3", "is_leader": false }
  ],
  "leader": "node-1"
}</code></pre>

      <h2>Load Balancing</h2>

      <p>Distribute traffic across all nodes using a load balancer:</p>

      <h3>nginx Configuration</h3>

      <pre><code><span class="comment"># nginx.conf</span>
upstream flashq_tcp {
    least_conn;
    server node1:6789;
    server node2:6793;
    server node3:6795;
}

upstream flashq_http {
    least_conn;
    server node1:6790;
    server node2:6792;
    server node3:6794;
}

server {
    listen 6789;
    proxy_pass flashq_tcp;
}

server {
    listen 80;
    location / {
        proxy_pass http://flashq_http;
    }
}</code></pre>

      <h2>Kubernetes Deployment</h2>

      <h3>StatefulSet for flashQ Nodes</h3>

      <pre><code>apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: flashq
spec:
  serviceName: flashq
  replicas: 3
  selector:
    matchLabels:
      app: flashq
  template:
    metadata:
      labels:
        app: flashq
    spec:
      containers:
        - name: flashq
          image: flashq/flashq-server:latest
          env:
            - name: CLUSTER_MODE
              value: "1"
            - name: NODE_ID
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: flashq-secrets
                  key: database-url
            - name: HTTP
              value: "1"
          ports:
            - containerPort: 6789
              name: tcp
            - containerPort: 6790
              name: http
          livenessProbe:
            httpGet:
              path: /health
              port: 6790
            initialDelaySeconds: 10
          readinessProbe:
            httpGet:
              path: /health
              port: 6790
            initialDelaySeconds: 5</code></pre>

      <h3>Service for Load Balancing</h3>

      <pre><code>apiVersion: v1
kind: Service
metadata:
  name: flashq
spec:
  selector:
    app: flashq
  ports:
    - name: tcp
      port: 6789
      targetPort: 6789
    - name: http
      port: 6790
      targetPort: 6790
  type: ClusterIP</code></pre>

      <h2>Client Configuration</h2>

      <p>Connect clients to the load balancer:</p>

      <pre><code><span class="keyword">import</span> { FlashQ } <span class="keyword">from</span> <span class="string">'flashq'</span>;

<span class="comment">// Connect to load balancer</span>
<span class="keyword">const</span> client = <span class="keyword">new</span> <span class="function">FlashQ</span>({
  host: <span class="string">'flashq-lb.internal'</span>,  <span class="comment">// Load balancer address</span>
  port: <span class="number">6789</span>,
  token: process.env.FLASHQ_TOKEN
});

<span class="keyword">await</span> client.<span class="function">connect</span>();

<span class="comment">// All operations work transparently</span>
<span class="keyword">await</span> client.<span class="function">push</span>(<span class="string">'my-queue'</span>, { data: <span class="string">'test'</span> });</code></pre>

      <div class="callout callout-info">
        <strong>Best Practice:</strong> Always use an odd number of nodes (3, 5, 7) to prevent split-brain scenarios during network partitions.
      </div>

      <h2>Related Resources</h2>
      <ul>
        <li><a href="production-checklist.html">Production Checklist</a></li>
        <li><a href="debugging-queue-problems.html">Debugging Queue Problems</a></li>
        <li><a href="monitoring-ai-pipelines.html">Monitoring AI Pipelines</a></li>
      </ul>

      <div class="article-cta">
        <h3>Ready for High Availability?</h3>
        <p>Deploy flashQ with clustering for production workloads.</p>
        <a href="../docs/#quickstart" class="btn btn-primary">Get Started â†’</a>
      </div>
    </div>
  </article>

  <footer>
    <div class="container">
      <a href="../" class="logo"><span>âš¡</span> flashQ</a>
      <div class="footer-links">
        <a href="https://github.com/egeominotti/flashq" target="_blank">GitHub</a>
        <a href="https://npmjs.com/package/flashq" target="_blank">npm</a>
        <a href="../docs/">Docs</a>
        <a href="../blog/">Blog</a>
      </div>
      <div class="footer-copy">Â© 2026 flashQ. MIT License.</div>
    </div>
  </footer>

  <script src="script.js"></script>
</body>
</html>
