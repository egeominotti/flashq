<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Building Webhook Handlers with flashQ: Complete Tutorial - flashQ Blog</title>
  <meta name="description" content="Learn to build secure, reliable webhook handlers with flashQ. Cover signature verification, retry logic, idempotency, and processing webhooks from Stripe, GitHub, and more.">
  <meta name="keywords" content="webhook handlers, flashq webhooks, stripe webhooks, github webhooks, webhook processing, webhook queue, async webhooks, webhook security">
  <meta name="robots" content="index, follow">

  <meta property="og:title" content="Building Webhook Handlers with flashQ: Complete Tutorial">
  <meta property="og:description" content="Build secure, reliable webhook handlers with flashQ. Signature verification, retries, and idempotency.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://flashq.dev/blog/building-webhook-handlers.html">
  <meta property="og:image" content="https://flashq.dev/og-image.png">
  <meta property="article:published_time" content="2026-01-19">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Building Webhook Handlers with flashQ">
  <meta name="twitter:description" content="Secure, reliable webhook handlers with flashQ.">
  <meta name="twitter:image" content="https://flashq.dev/og-image.png">

  <link rel="canonical" href="https://flashq.dev/blog/building-webhook-handlers.html">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš¡</text></svg>">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "Building Webhook Handlers with flashQ: Complete Tutorial",
    "description": "Comprehensive guide to building secure webhook handlers with flashQ job queues.",
    "datePublished": "2026-01-19",
    "author": { "@type": "Organization", "name": "flashQ" },
    "publisher": { "@type": "Organization", "name": "flashQ", "url": "https://flashq.dev" }
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://flashq.dev" },
      { "@type": "ListItem", "position": 2, "name": "Blog", "item": "https://flashq.dev/blog/" },
      { "@type": "ListItem", "position": 3, "name": "Building Webhook Handlers", "item": "https://flashq.dev/blog/building-webhook-handlers.html" }
    ]
  }
  </script>
</head>
<body>
  <nav>
    <div class="container wide">
      <a href="../" class="logo"><span>âš¡</span> flashQ</a>
      <div class="nav-links">
        <a href="../#features">Features</a>
        <a href="../blog/" class="active">Blog</a>
        <a href="../docs/">Docs</a>
        <a href="https://github.com/egeominotti/flashq" target="_blank">GitHub</a>
        <a href="../docs/#quickstart" class="btn btn-primary">Get Started</a>
      </div>
      <button class="mobile-menu-btn" aria-label="Menu"><span></span><span></span><span></span></button>
    </div>
  </nav>

  <div class="mobile-menu">
    <a href="../#features">Features</a>
    <a href="../blog/">Blog</a>
    <a href="../docs/">Docs</a>
    <a href="https://github.com/egeominotti/flashq" target="_blank">GitHub</a>
    <a href="../docs/#quickstart" class="btn btn-primary">Get Started</a>
  </div>

  <header class="article-header">
    <div class="container">
      <span class="article-tag">Integration</span>
      <h1>Building Webhook Handlers with flashQ</h1>
      <div class="article-meta">
        <span>ğŸ“… January 19, 2026</span>
        <span>â±ï¸ 10 min read</span>
      </div>
    </div>
  </header>

  <article class="article-content">
    <div class="container">
      <p>Webhooks need to be fast, secure, and reliable. Learn how to build production-grade webhook handlers using flashQ with proper signature verification, idempotency, and async processing.</p>

      <h2>The Webhook Challenge</h2>

      <p>Webhook providers expect fast responses (typically under 3 seconds). If processing takes longer, you risk timeouts and retries. The solution: immediately queue webhook payloads and process them asynchronously.</p>

      <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     POST /webhook      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Stripe    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  Your API    â”‚
â”‚   (sender)  â”‚                        â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  1. Verify   â”‚
                                       â”‚  2. Queue    â”‚
     â† 200 OK (immediate)              â”‚  3. Return   â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â†“
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚   flashQ     â”‚
                                       â”‚   Worker     â”‚
                                       â”‚              â”‚
                                       â”‚  Process     â”‚
                                       â”‚  webhook     â”‚
                                       â”‚  async       â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

      <h2>Basic Webhook Handler</h2>

      <pre><code><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">'express'</span>;
<span class="keyword">import</span> { FlashQ, Worker } <span class="keyword">from</span> <span class="string">'flashq'</span>;

<span class="keyword">const</span> app = <span class="function">express</span>();
<span class="keyword">const</span> client = <span class="keyword">new</span> <span class="function">FlashQ</span>({ host: <span class="string">'localhost'</span>, port: <span class="number">6789</span> });

<span class="keyword">await</span> client.<span class="function">connect</span>();

<span class="comment">// Webhook endpoint - fast response, async processing</span>
app.<span class="function">post</span>(<span class="string">'/webhook'</span>, express.<span class="function">raw</span>({ type: <span class="string">'application/json'</span> }), <span class="keyword">async</span> (req, res) => {
  <span class="keyword">try</span> {
    <span class="keyword">const</span> payload = JSON.<span class="function">parse</span>(req.body.<span class="function">toString</span>());

    <span class="comment">// Queue for async processing</span>
    <span class="keyword">await</span> client.<span class="function">push</span>(<span class="string">'webhooks'</span>, {
      source: <span class="string">'generic'</span>,
      payload,
      receivedAt: Date.<span class="function">now</span>()
    });

    res.<span class="function">status</span>(<span class="number">200</span>).<span class="function">send</span>(<span class="string">'OK'</span>);
  } <span class="keyword">catch</span> (error) {
    res.<span class="function">status</span>(<span class="number">400</span>).<span class="function">send</span>(<span class="string">'Invalid payload'</span>);
  }
});

<span class="comment">// Worker processes webhooks asynchronously</span>
<span class="keyword">const</span> worker = <span class="keyword">new</span> <span class="function">Worker</span>(<span class="string">'webhooks'</span>, <span class="keyword">async</span> (job) => {
  <span class="keyword">const</span> { source, payload } = job.data;
  console.<span class="function">log</span>(<span class="string">`Processing webhook from </span>${source}<span class="string">`</span>);
  <span class="keyword">await</span> <span class="function">processWebhook</span>(payload);
});

app.<span class="function">listen</span>(<span class="number">3000</span>);</code></pre>

      <h2>Stripe Webhook Handler</h2>

      <p>Stripe webhooks require signature verification using their <code>stripe-signature</code> header:</p>

      <pre><code><span class="keyword">import</span> Stripe <span class="keyword">from</span> <span class="string">'stripe'</span>;
<span class="keyword">import</span> { FlashQ, Worker } <span class="keyword">from</span> <span class="string">'flashq'</span>;

<span class="keyword">const</span> stripe = <span class="keyword">new</span> <span class="function">Stripe</span>(process.env.STRIPE_SECRET_KEY);
<span class="keyword">const</span> client = <span class="keyword">new</span> <span class="function">FlashQ</span>({ host: <span class="string">'localhost'</span>, port: <span class="number">6789</span> });

<span class="keyword">await</span> client.<span class="function">connect</span>();

app.<span class="function">post</span>(<span class="string">'/webhook/stripe'</span>, express.<span class="function">raw</span>({ type: <span class="string">'application/json'</span> }), <span class="keyword">async</span> (req, res) => {
  <span class="keyword">const</span> signature = req.headers[<span class="string">'stripe-signature'</span>];

  <span class="keyword">try</span> {
    <span class="comment">// 1. Verify signature</span>
    <span class="keyword">const</span> event = stripe.webhooks.<span class="function">constructEvent</span>(
      req.body,
      signature,
      process.env.STRIPE_WEBHOOK_SECRET
    );

    <span class="comment">// 2. Queue with idempotency key (Stripe event ID)</span>
    <span class="keyword">await</span> client.<span class="function">push</span>(<span class="string">'stripe-webhooks'</span>, {
      eventId: event.id,
      type: event.type,
      data: event.data.object
    }, {
      unique_key: event.id  <span class="comment">// Prevents duplicate processing</span>
    });

    <span class="comment">// 3. Acknowledge immediately</span>
    res.<span class="function">status</span>(<span class="number">200</span>).<span class="function">json</span>({ received: <span class="keyword">true</span> });

  } <span class="keyword">catch</span> (error) {
    console.<span class="function">error</span>(<span class="string">'Webhook error:'</span>, error.message);
    res.<span class="function">status</span>(<span class="number">400</span>).<span class="function">send</span>(<span class="string">`Webhook Error: </span>${error.message}<span class="string">`</span>);
  }
});

<span class="comment">// Stripe webhook worker</span>
<span class="keyword">const</span> stripeWorker = <span class="keyword">new</span> <span class="function">Worker</span>(<span class="string">'stripe-webhooks'</span>, <span class="keyword">async</span> (job) => {
  <span class="keyword">const</span> { eventId, type, data } = job.data;

  <span class="keyword">switch</span> (type) {
    <span class="keyword">case</span> <span class="string">'payment_intent.succeeded'</span>:
      <span class="keyword">await</span> <span class="function">handlePaymentSuccess</span>(data);
      <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="string">'customer.subscription.created'</span>:
      <span class="keyword">await</span> <span class="function">handleNewSubscription</span>(data);
      <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="string">'invoice.payment_failed'</span>:
      <span class="keyword">await</span> <span class="function">handleFailedPayment</span>(data);
      <span class="keyword">break</span>;
    <span class="keyword">default</span>:
      console.<span class="function">log</span>(<span class="string">`Unhandled event type: </span>${type}<span class="string">`</span>);
  }
}, { concurrency: <span class="number">5</span> });</code></pre>

      <h2>GitHub Webhook Handler</h2>

      <p>GitHub uses HMAC-SHA256 signatures in the <code>x-hub-signature-256</code> header:</p>

      <pre><code><span class="keyword">import</span> { createHmac } <span class="keyword">from</span> <span class="string">'crypto'</span>;
<span class="keyword">import</span> { FlashQ, Worker } <span class="keyword">from</span> <span class="string">'flashq'</span>;

<span class="keyword">const</span> client = <span class="keyword">new</span> <span class="function">FlashQ</span>({ host: <span class="string">'localhost'</span>, port: <span class="number">6789</span> });

<span class="keyword">function</span> <span class="function">verifyGitHubSignature</span>(payload, signature, secret) {
  <span class="keyword">const</span> expected = <span class="string">'sha256='</span> + <span class="function">createHmac</span>(<span class="string">'sha256'</span>, secret)
    .<span class="function">update</span>(payload)
    .<span class="function">digest</span>(<span class="string">'hex'</span>);

  <span class="keyword">return</span> signature === expected;
}

app.<span class="function">post</span>(<span class="string">'/webhook/github'</span>, express.<span class="function">raw</span>({ type: <span class="string">'application/json'</span> }), <span class="keyword">async</span> (req, res) => {
  <span class="keyword">const</span> signature = req.headers[<span class="string">'x-hub-signature-256'</span>];
  <span class="keyword">const</span> event = req.headers[<span class="string">'x-github-event'</span>];
  <span class="keyword">const</span> deliveryId = req.headers[<span class="string">'x-github-delivery'</span>];

  <span class="comment">// 1. Verify signature</span>
  <span class="keyword">if</span> (!<span class="function">verifyGitHubSignature</span>(req.body, signature, process.env.GITHUB_WEBHOOK_SECRET)) {
    <span class="keyword">return</span> res.<span class="function">status</span>(<span class="number">401</span>).<span class="function">send</span>(<span class="string">'Invalid signature'</span>);
  }

  <span class="keyword">const</span> payload = JSON.<span class="function">parse</span>(req.body.<span class="function">toString</span>());

  <span class="comment">// 2. Queue with delivery ID as unique key</span>
  <span class="keyword">await</span> client.<span class="function">push</span>(<span class="string">'github-webhooks'</span>, {
    deliveryId,
    event,
    payload
  }, {
    unique_key: deliveryId  <span class="comment">// Idempotency</span>
  });

  res.<span class="function">status</span>(<span class="number">200</span>).<span class="function">send</span>(<span class="string">'OK'</span>);
});

<span class="comment">// GitHub webhook worker</span>
<span class="keyword">const</span> githubWorker = <span class="keyword">new</span> <span class="function">Worker</span>(<span class="string">'github-webhooks'</span>, <span class="keyword">async</span> (job) => {
  <span class="keyword">const</span> { event, payload } = job.data;

  <span class="keyword">switch</span> (event) {
    <span class="keyword">case</span> <span class="string">'push'</span>:
      <span class="keyword">await</span> <span class="function">handlePush</span>(payload);
      <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="string">'pull_request'</span>:
      <span class="keyword">await</span> <span class="function">handlePullRequest</span>(payload);
      <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="string">'issues'</span>:
      <span class="keyword">await</span> <span class="function">handleIssue</span>(payload);
      <span class="keyword">break</span>;
  }
});</code></pre>

      <h2>Generic HMAC Verification</h2>

      <p>For services using standard HMAC-SHA256:</p>

      <pre><code><span class="keyword">import</span> { createHmac, timingSafeEqual } <span class="keyword">from</span> <span class="string">'crypto'</span>;

<span class="keyword">function</span> <span class="function">verifyHmacSignature</span>(payload, signature, secret) {
  <span class="keyword">const</span> expected = <span class="function">createHmac</span>(<span class="string">'sha256'</span>, secret)
    .<span class="function">update</span>(payload)
    .<span class="function">digest</span>(<span class="string">'hex'</span>);

  <span class="comment">// Extract hex part if prefixed (e.g., "sha256=...")</span>
  <span class="keyword">const</span> received = signature.<span class="function">replace</span>(<span class="string">'sha256='</span>, <span class="string">''</span>);

  <span class="comment">// Use timing-safe comparison to prevent timing attacks</span>
  <span class="keyword">try</span> {
    <span class="keyword">return</span> <span class="function">timingSafeEqual</span>(
      Buffer.<span class="function">from</span>(expected, <span class="string">'hex'</span>),
      Buffer.<span class="function">from</span>(received, <span class="string">'hex'</span>)
    );
  } <span class="keyword">catch</span> {
    <span class="keyword">return</span> <span class="keyword">false</span>;
  }
}</code></pre>

      <h2>Idempotency with unique_key</h2>

      <p>Webhook providers often retry on failures. Use flashQ's <code>unique_key</code> to prevent duplicate processing:</p>

      <pre><code><span class="comment">// Stripe: Use event ID</span>
<span class="keyword">await</span> client.<span class="function">push</span>(<span class="string">'stripe'</span>, data, {
  unique_key: event.id
});

<span class="comment">// GitHub: Use delivery ID</span>
<span class="keyword">await</span> client.<span class="function">push</span>(<span class="string">'github'</span>, data, {
  unique_key: deliveryId
});

<span class="comment">// Custom: Generate from payload</span>
<span class="keyword">const</span> idempotencyKey = <span class="function">createHash</span>(<span class="string">'sha256'</span>)
  .<span class="function">update</span>(JSON.<span class="function">stringify</span>(payload))
  .<span class="function">digest</span>(<span class="string">'hex'</span>);

<span class="keyword">await</span> client.<span class="function">push</span>(<span class="string">'webhooks'</span>, data, {
  unique_key: idempotencyKey
});</code></pre>

      <h2>Error Handling & Retries</h2>

      <pre><code><span class="keyword">const</span> worker = <span class="keyword">new</span> <span class="function">Worker</span>(<span class="string">'webhooks'</span>, <span class="keyword">async</span> (job) => {
  <span class="keyword">const</span> { eventId, type, data } = job.data;

  <span class="keyword">try</span> {
    <span class="keyword">await</span> <span class="function">processWebhook</span>(type, data);
  } <span class="keyword">catch</span> (error) {
    <span class="comment">// Log for debugging</span>
    console.<span class="function">error</span>(<span class="string">`Webhook </span>${eventId}<span class="string"> failed:`</span>, error);

    <span class="comment">// Check if we should retry</span>
    <span class="keyword">if</span> (<span class="function">isRetryableError</span>(error)) {
      <span class="keyword">throw</span> error; <span class="comment">// Triggers automatic retry</span>
    }

    <span class="comment">// Non-retryable: log and complete</span>
    <span class="keyword">await</span> <span class="function">logFailedWebhook</span>(eventId, error);
  }
});

<span class="keyword">function</span> <span class="function">isRetryableError</span>(error) {
  <span class="keyword">const</span> retryableCodes = [<span class="number">408</span>, <span class="number">429</span>, <span class="number">500</span>, <span class="number">502</span>, <span class="number">503</span>, <span class="number">504</span>];
  <span class="keyword">return</span> error.message.<span class="function">includes</span>(<span class="string">'ECONNREFUSED'</span>) ||
         error.message.<span class="function">includes</span>(<span class="string">'ETIMEDOUT'</span>) ||
         retryableCodes.<span class="function">some</span>(code => error.message.<span class="function">includes</span>(String(code)));
}</code></pre>

      <h2>Webhook Configuration Options</h2>

      <pre><code><span class="comment">// Configure retry behavior</span>
<span class="keyword">await</span> client.<span class="function">push</span>(<span class="string">'webhooks'</span>, payload, {
  unique_key: eventId,        <span class="comment">// Idempotency</span>
  max_attempts: <span class="number">5</span>,            <span class="comment">// Retry 5 times</span>
  backoff: <span class="number">1000</span>,              <span class="comment">// Start with 1s delay</span>
  timeout: <span class="number">30000</span>,             <span class="comment">// 30s processing timeout</span>
  priority: <span class="number">10</span>                <span class="comment">// Higher priority</span>
});</code></pre>

      <div class="callout callout-success">
        <strong>Key Takeaways:</strong> Always verify signatures, use unique_key for idempotency, respond immediately (200 OK), and process asynchronously with proper retry logic.
      </div>

      <h2>Related Resources</h2>
      <ul>
        <li><a href="error-handling-retry-patterns.html">Error Handling & Retry Patterns</a></li>
        <li><a href="production-checklist.html">Production Checklist</a></li>
        <li><a href="debugging-queue-problems.html">Debugging Queue Problems</a></li>
      </ul>

      <div class="article-cta">
        <h3>Build Reliable Webhooks</h3>
        <p>Get started with flashQ for secure, reliable webhook processing.</p>
        <a href="../docs/#quickstart" class="btn btn-primary">Get Started â†’</a>
      </div>
    </div>
  </article>

  <footer>
    <div class="container">
      <a href="../" class="logo"><span>âš¡</span> flashQ</a>
      <div class="footer-links">
        <a href="https://github.com/egeominotti/flashq" target="_blank">GitHub</a>
        <a href="https://npmjs.com/package/flashq" target="_blank">npm</a>
        <a href="../docs/">Docs</a>
        <a href="../blog/">Blog</a>
      </div>
      <div class="footer-copy">Â© 2026 flashQ. MIT License.</div>
    </div>
  </footer>

  <script src="script.js"></script>
</body>
</html>
